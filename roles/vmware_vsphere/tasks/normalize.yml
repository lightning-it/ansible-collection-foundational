---
# Normalize/alias variables so inventories can use shorter names
# while the role keeps its strict internal API.

- name: Normalize vSphere placement vars
  ansible.builtin.set_fact:
    vmware_vsphere_vmware_guest_cluster: >-
      {{ vmware_vsphere_vmware_guest_cluster
         | default(vmware_vsphere_cluster | default('')) }}
    vmware_vsphere_vmware_guest_esxi_hostname: >-
      {{ vmware_vsphere_vmware_guest_esxi_hostname
         | default(vmware_vsphere_esxi_hostname | default('')) }}
    vmware_vsphere_hostname: >-
      {{
        vmware_vsphere_hostname
          | default(vcenter_hostname | default('', true), true)
          | default('', true)
      }}
  tags:
    - always

- name: Normalize datastore vars
  ansible.builtin.set_fact:
    vmware_vsphere_vmware_guest_datastore: >-
      {{ vmware_vsphere_vmware_guest_datastore
         | default(vmware_vsphere_datastore | default('')) }}
    vmware_vsphere_vmware_iso_datastore: >-
      {{ vmware_vsphere_vmware_iso_datastore
         | default(vmware_vsphere_iso_datastore | default('')) }}
  tags:
    - always

- name: Normalize network vars
  ansible.builtin.set_fact:
    # canonical internal var
    vmware_vsphere_vmware_guest_network: >-
      {{ vmware_vsphere_vmware_guest_network
         | default(vmware_vsphere_network | default('')) }}
    vmware_vsphere_vmware_guest_networks: |
      [
      {%- for net in (
            vmware_vsphere_vmware_guest_networks
              | default(
                  (vmware_vsphere_network is sequence)
                    | ternary(vmware_vsphere_network, [vmware_vsphere_network])
                )
          )
      -%}
        {{
          (net if net is mapping else {'name': net})
            | combine({'connected': true, 'start_connected': true})
        }}{% if not loop.last %},{% endif %}
      {%- endfor -%}
      ]
    # optional legacy alias (keep both in sync)
    vmware_vsphere_network: >-
      {{ vmware_vsphere_network
         | default(vmware_vsphere_vmware_guest_network | default('')) }}
  tags:
    - always
